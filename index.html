<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RampBlueprint ‚Äî DIY Skateboard Ramp Calculator</title>
  <meta name="description" content="Free DIY skateboard ramp blueprints with materials lists, cost estimates, and step-by-step build instructions. Mini ramps, quarter pipes, kickers, grind boxes, and rails.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî®</text></svg>">
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #151515;
      --surface-2: #1e1e1e;
      --border: #2a2a2a;
      --text: #e8e8e8;
      --text-dim: #888;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --green: #22c55e;
      --blue: #3b82f6;
      --red: #ef4444;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    
    header { text-align: center; padding: 3rem 1rem 2rem; border-bottom: 1px solid var(--border); }
    header h1 { font-size: 2.5rem; font-weight: 800; }
    header h1 span { color: var(--accent); }
    header p { color: var(--text-dim); margin-top: 0.5rem; font-size: 1.1rem; }

    /* Unit toggle */
    .unit-toggle { display: inline-flex; border: 1px solid var(--border); border-radius: 999px; overflow: hidden; margin-top: 0.75rem; font-size: 0.85rem; }
    .unit-toggle button { padding: 0.35rem 1rem; border: none; background: var(--surface); color: var(--text-dim); cursor: pointer; transition: all 0.2s; font-weight: 600; }
    .unit-toggle button.active { background: var(--accent); color: var(--bg); }
    .unit-toggle button:hover:not(.active) { color: var(--text); }

    .container { max-width: 1100px; margin: 0 auto; padding: 2rem 1rem; }

    /* Ramp type filters */
    .filters { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 2rem; justify-content: center; }
    .filter-btn { padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 999px; background: var(--surface); color: var(--text-dim); cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
    .filter-btn:hover, .filter-btn.active { border-color: var(--accent); color: var(--accent); background: var(--surface-2); }

    /* Ramp grid */
    .ramp-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; }
    .ramp-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.2s; }
    .ramp-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .ramp-card-header { padding: 1.5rem; }
    .ramp-card h2 { font-size: 1.3rem; margin-bottom: 0.25rem; }
    .ramp-card .type-badge { display: inline-block; padding: 0.15rem 0.6rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
    .type-badge.mini-ramp { background: #3b82f620; color: var(--blue); }
    .type-badge.quarter-pipe { background: #22c55e20; color: var(--green); }
    .type-badge.kicker { background: #f59e0b20; color: var(--accent); }
    .type-badge.box { background: #ef444420; color: var(--red); }
    .type-badge.rail { background: #a855f720; color: #a855f7; }
    .ramp-card .desc { color: var(--text-dim); font-size: 0.9rem; margin-top: 0.75rem; }
    .ramp-card .meta { display: flex; gap: 1rem; padding: 1rem 1.5rem; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-dim); }
    .ramp-card .meta span { display: flex; align-items: center; gap: 0.3rem; }

    /* Detail modal */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; overflow-y: auto; padding: 2rem 1rem; }
    .modal-overlay.active { display: block; }
    .modal { max-width: 800px; margin: 0 auto; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
    .modal-head { display: flex; justify-content: space-between; align-items: flex-start; padding: 2rem; border-bottom: 1px solid var(--border); }
    .modal-head h2 { font-size: 1.8rem; }

    /* Cut Diagram */
    .cut-diagram { margin-top: 0.5rem; }
    .cut-sheet { margin-bottom: 1.5rem; }
    .cut-sheet-label { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.4rem; font-weight: 600; }
    .cut-sheet svg { width: 100%; max-width: 480px; border-radius: 8px; }
    .cut-waste { font-size: 0.8rem; color: var(--text-dim); margin-top: 1rem; }
    .cut-waste strong { color: var(--accent); }
    .modal-close { background: none; border: none; color: var(--text-dim); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; }
    .modal-close:hover { color: var(--text); }
    .print-btn { padding: 0.5rem 1rem; border: 1px solid var(--accent); border-radius: 8px; background: transparent; color: var(--accent); cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; }
    .print-btn:hover { background: var(--accent); color: var(--bg); }

    @media print {
      body * { visibility: hidden; }
      .modal, .modal * { visibility: visible; }
      .modal { position: absolute; left: 0; top: 0; width: 100%; border: none; background: #fff; color: #111; }
      .modal-overlay { display: block !important; position: absolute; background: #fff; overflow: visible; }
      .modal-head { border-bottom: 2px solid #333; }
      .modal-head h2 { color: #111; }
      .modal-body { color: #111; }
      .blueprint { background: #f5f5f5; border: 1px solid #ccc; }
      .blueprint svg text { fill: #111; }
      .blueprint svg line, .blueprint svg rect, .blueprint svg path { stroke: #333; }
      .dim-box { background: #f0f0f0; border: 1px solid #ccc; }
      .dim-box .val { color: #b45309; }
      .dim-box .label { color: #555; }
      .section-title { color: #111; border-bottom-color: #333; }
      th { color: #555; border-bottom-color: #333; }
      td { border-bottom-color: #ddd; color: #111; }
      td.qty { color: #b45309; }
      .modal-close, .print-btn, .no-print { display: none !important; }
      .type-badge { border: 1px solid currentColor; }
      a { color: #111; text-decoration: none; }
    }
    .modal-body { padding: 2rem; }

    /* Blueprint SVG */
    .blueprint { background: #0d1117; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 2rem; text-align: center; }
    .blueprint svg { max-width: 100%; height: auto; }

    /* Dimensions */
    .dims { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .dim-box { text-align: center; padding: 1rem; background: var(--surface-2); border-radius: 8px; }
    .dim-box .val { font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    .dim-box .label { font-size: 0.8rem; color: var(--text-dim); }

    /* Materials table */
    .section-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }
    table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
    th { text-align: left; padding: 0.6rem; font-size: 0.8rem; text-transform: uppercase; color: var(--text-dim); border-bottom: 1px solid var(--border); }
    td { padding: 0.6rem; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
    td.qty { font-weight: 700; color: var(--accent); text-align: center; }

    /* Cost & time */
    .cost-time { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
    .cost-time .box { padding: 1.25rem; background: var(--surface-2); border-radius: 8px; text-align: center; }
    .cost-time .box .val { font-size: 1.4rem; font-weight: 700; color: var(--green); }
    .cost-time .box .label { font-size: 0.8rem; color: var(--text-dim); }

    /* Steps */
    .steps { list-style: none; counter-reset: step; margin-bottom: 2rem; }
    .steps li { counter-increment: step; padding: 0.75rem 0 0.75rem 3rem; border-bottom: 1px solid var(--border); position: relative; }
    .steps li::before { content: counter(step); position: absolute; left: 0; top: 0.75rem; width: 2rem; height: 2rem; background: var(--accent-dim); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; }

    /* Tools */
    .tools-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 2rem; }
    .tool-tag { padding: 0.3rem 0.8rem; background: var(--surface-2); border: 1px solid var(--border); border-radius: 999px; font-size: 0.85rem; }

    /* Calculator */
    .calculator { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; margin-top: 2rem; }
    .calc-title { font-size: 1.5rem; margin-bottom: 0.5rem; }
    .calc-desc { color: var(--text-dim); margin-bottom: 1.5rem; font-size: 0.95rem; }
    .calc-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; align-items: end; }
    .calc-field label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem; text-transform: uppercase; font-weight: 600; }
    .calc-field select, .calc-field input { width: 100%; padding: 0.7rem; background: var(--surface-2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem; }
    .calc-field select:focus, .calc-field input:focus { outline: none; border-color: var(--accent); }
    .calc-btn { padding: 0.7rem 1.5rem; background: var(--accent); color: #000; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: background 0.2s; }
    .calc-btn:hover { background: #fbbf24; }
    .calc-result { margin-top: 1.5rem; }
    .calc-result:empty { display: none; }
    .calc-result table { margin-bottom: 1rem; }
    .calc-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .calc-summary .box { padding: 1rem; background: var(--surface-2); border-radius: 8px; text-align: center; }
    .calc-summary .box .val { font-size: 1.3rem; font-weight: 700; color: var(--accent); }
    .calc-summary .box .label { font-size: 0.8rem; color: var(--text-dim); }
    .calc-cost { font-size: 1.1rem; font-weight: 600; color: var(--green); text-align: center; margin-top: 1rem; }

    footer { text-align: center; padding: 2rem; color: var(--text-dim); font-size: 0.85rem; border-top: 1px solid var(--border); }
    footer a { color: var(--accent); text-decoration: none; }

    @media (max-width: 600px) {
      header h1 { font-size: 1.8rem; }
      .ramp-grid { grid-template-columns: 1fr; }
      .dims { grid-template-columns: repeat(2, 1fr); }
      .cost-time { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>üî® Ramp<span>Blueprint</span></h1>
    <p>Free DIY skateboard ramp plans ‚Äî blueprints, materials lists &amp; build guides</p>
    <div class="unit-toggle" id="unitToggle">
      <button class="active" data-unit="imperial">Inches</button>
      <button data-unit="metric">Centimeters</button>
    </div>
    <nav style="margin-top:1rem"><a href="gallery.html" style="color:var(--accent);text-decoration:none;font-weight:600;border:1px solid var(--accent);padding:0.4rem 1rem;border-radius:999px;font-size:0.9rem">üì∏ Community Builds Gallery</a></nav>
  </header>

  <div class="container">
    <div class="filters" id="filters"></div>
    <div class="ramp-grid" id="rampGrid"></div>
  </div>

  <!-- Custom Dimension Calculator -->
  <div class="container" id="calculatorSection">
    <div class="calculator">
      <h2 class="calc-title">üìê Custom Dimension Calculator</h2>
      <p class="calc-desc">Enter your own dimensions and get an auto-generated materials list scaled to your build.</p>
      <div class="calc-form">
        <div class="calc-field">
          <label for="calcType">Ramp Type</label>
          <select id="calcType"></select>
        </div>
        <div class="calc-field">
          <label for="calcHeight">Height (<span class="calc-unit-label">inches</span>)</label>
          <input type="number" id="calcHeight" min="6" max="144" placeholder="e.g. 36">
        </div>
        <div class="calc-field">
          <label for="calcWidth">Width (<span class="calc-unit-label">inches</span>)</label>
          <input type="number" id="calcWidth" min="12" max="240" placeholder="e.g. 96">
        </div>
        <div class="calc-field">
          <label for="calcLength">Length (<span class="calc-unit-label">inches</span>)</label>
          <input type="number" id="calcLength" min="12" max="360" placeholder="e.g. 192">
        </div>
        <button class="calc-btn" id="calcBtn">Generate Materials List</button>
      </div>
      <div id="calcResult" class="calc-result"></div>
    </div>
  </div>

  <div class="modal-overlay" id="modal">
    <div class="modal">
      <div class="modal-head">
        <div><h2 id="modalTitle"></h2><div id="modalBadge"></div></div>
        <div style="display:flex;gap:0.5rem;align-items:flex-start;">
          <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / PDF</button>
          <button class="modal-close" id="modalClose">&times;</button>
        </div>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <footer>
    <p>Built by <a href="https://github.com/clawdiard">Clawdia</a> ¬∑ No database, no signup ‚Äî just blueprints üõπ</p>
  </footer>

  <script>
    function renderCutSheet(sheet, sheetSize) {
      // Determine sheet dims from size string
      let sheetW = 96, sheetH = 48;
      if (sheetSize.includes('2√ó2')) { sheetW = 24; sheetH = 24; }
      
      const svgW = 480, svgH = Math.round(480 * (sheetH / sheetW));
      const pad = 2;
      const scaleX = (svgW - pad*2) / sheetW;
      const scaleY = (svgH - pad*2) / sheetH;
      
      let rects = '';
      for (const c of sheet.cuts) {
        const rx = pad + c.x * scaleX;
        const ry = pad + c.y * scaleY;
        const rw = c.w * scaleX - 2;
        const rh = c.h * scaleY - 2;
        const fontSize = Math.min(rh / 3, 13);
        const lines = c.label.split('\n');
        const textY = ry + rh/2 - (lines.length - 1) * fontSize * 0.6;
        rects += `<rect x="${rx}" y="${ry}" width="${rw}" height="${rh}" rx="4" fill="${c.color}22" stroke="${c.color}" stroke-width="1.5"/>`;
        lines.forEach((line, i) => {
          rects += `<text x="${rx + rw/2}" y="${textY + i * fontSize * 1.2}" text-anchor="middle" fill="${c.color}" font-size="${fontSize}" font-weight="600">${line}</text>`;
        });
        // Dimension labels
        const dimFontSize = Math.min(fontSize * 0.7, 9);
        rects += `<text x="${rx + rw/2}" y="${ry + rh - dimFontSize*0.5}" text-anchor="middle" fill="#64748b" font-size="${dimFontSize}">${c.w}" √ó ${c.h}"</text>`;
      }
      
      return `<svg viewBox="0 0 ${svgW} ${svgH}" xmlns="http://www.w3.org/2000/svg">
        <rect width="${svgW}" height="${svgH}" fill="#0d1117" rx="8"/>
        <rect x="${pad}" y="${pad}" width="${svgW-pad*2}" height="${svgH-pad*2}" fill="none" stroke="#334155" stroke-width="1" stroke-dasharray="4" rx="4"/>
        ${rects}
      </svg>`;
    }

    let ramps = [];
    let activeFilter = 'all';
    let currentUnit = 'imperial'; // 'imperial' or 'metric'
    let currentModalRampId = null;

    const IN_TO_CM = 2.54;
    function dimVal(inches) {
      if (currentUnit === 'metric') return Math.round(inches * IN_TO_CM);
      return inches;
    }
    function dimLabel(inches) {
      if (currentUnit === 'metric') return `${Math.round(inches * IN_TO_CM)} cm`;
      return `${inches}"`;
    }
    function unitSuffix() { return currentUnit === 'metric' ? ' cm' : '"'; }
    function unitWord() { return currentUnit === 'metric' ? 'centimeters' : 'inches'; }

    async function init() {
      const res = await fetch('data/ramps.json');
      ramps = await res.json();
      renderFilters();
      renderGrid();
      initCalculator();
    }

    function renderFilters() {
      const types = ['all', ...new Set(ramps.map(r => r.type))];
      const labels = { 'all': 'All', 'mini-ramp': 'Mini Ramps', 'quarter-pipe': 'Quarter Pipes', 'kicker': 'Kickers', 'box': 'Boxes', 'rail': 'Rails' };
      document.getElementById('filters').innerHTML = types.map(t =>
        `<button class="filter-btn ${t === activeFilter ? 'active' : ''}" data-type="${t}">${labels[t] || t}</button>`
      ).join('');
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => { activeFilter = btn.dataset.type; renderFilters(); renderGrid(); });
      });
    }

    function renderGrid() {
      const filtered = activeFilter === 'all' ? ramps : ramps.filter(r => r.type === activeFilter);
      document.getElementById('rampGrid').innerHTML = filtered.map(r => `
        <div class="ramp-card" data-id="${r.id}">
          <div class="ramp-card-header">
            <span class="type-badge ${r.type}">${r.type.replace('-', ' ')}</span>
            <h2>${r.name}</h2>
            <p class="desc">${r.description}</p>
          </div>
          <div class="meta">
            <span>üí∞ $${r.estimatedCost.min}‚Äì$${r.estimatedCost.max}</span>
            <span>‚è± ${r.buildTime}</span>
            <span>üìè ${dimLabel(r.height)} h √ó ${dimLabel(r.width)} w</span>
          </div>
        </div>
      `).join('');
      document.querySelectorAll('.ramp-card').forEach(card => {
        card.addEventListener('click', () => openModal(card.dataset.id));
      });
    }

    function openModal(id) {
      const r = ramps.find(x => x.id === id);
      if (!r) return;
      currentModalRampId = id;
      document.getElementById('modalTitle').textContent = r.name;
      document.getElementById('modalBadge').innerHTML = `<span class="type-badge ${r.type}" style="margin-top:0.5rem;display:inline-block">${r.type.replace('-', ' ')}</span> <span style="color:var(--text-dim);font-size:0.9rem;margin-left:0.5rem">${r.difficulty}</span>`;

      const materialsRows = r.materials.filter(m => !m.optional).map(m =>
        `<tr><td>${m.item}</td><td class="qty">${m.qty}</td><td style="color:var(--text-dim)">${m.use}</td></tr>`
      ).join('');

      const optionalRows = r.materials.filter(m => m.optional).map(m =>
        `<tr style="opacity:0.6"><td>${m.item} ‚≠ê</td><td class="qty">‚Äì</td><td style="color:var(--text-dim)">${m.use}</td></tr>`
      ).join('');

      // Generate simple SVG blueprint
      const svg = generateBlueprint(r);

      document.getElementById('modalBody').innerHTML = `
        <p style="color:var(--text-dim);margin-bottom:1.5rem">${r.description}</p>
        
        <div class="blueprint">${svg}</div>

        <div class="dims">
          <div class="dim-box"><div class="val">${dimLabel(r.height)}</div><div class="label">Height</div></div>
          <div class="dim-box"><div class="val">${dimLabel(r.width)}</div><div class="label">Width</div></div>
          <div class="dim-box"><div class="val">${dimLabel(r.length)}</div><div class="label">Length</div></div>
          ${r.transitionRadius ? `<div class="dim-box"><div class="val">${dimLabel(r.transitionRadius)}</div><div class="label">Transition Radius</div></div>` : ''}
        </div>

        <div class="cost-time">
          <div class="box"><div class="val">$${r.estimatedCost.min} ‚Äì $${r.estimatedCost.max}</div><div class="label">Estimated Cost</div></div>
          <div class="box"><div class="val">${r.buildTime}</div><div class="label">Build Time</div></div>
        </div>

        <h3 class="section-title">üõ† Tools Needed</h3>
        <div class="tools-list">${r.tools.map(t => `<span class="tool-tag">${t}</span>`).join('')}</div>

        <h3 class="section-title">üì¶ Materials List</h3>
        <table><thead><tr><th>Material</th><th style="text-align:center">Qty</th><th>Use</th></tr></thead><tbody>${materialsRows}${optionalRows}</tbody></table>

        <h3 class="section-title">üìã Build Steps</h3>
        <ol class="steps">${r.steps.map(s => `<li>${s}</li>`).join('')}</ol>
      `;

      document.getElementById('modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function generateBlueprint(r) {
      const W = 560, H = 320;
      const pad = 45;
      const ground = H - pad;
      const col = {struct:'#f59e0b',dim:'#38bdf8',coping:'#3b82f6',frame:'#475569',label:'#94a3b8',bg:'#0d1117',grid:'#1e293b',accent:'#22d3ee',support:'#64748b'};

      // Helper: dimension line with arrows
      function dimLine(x1,y1,x2,y2,label,side='right',offset=0) {
        const vertical = x1===x2;
        const mx=(x1+x2)/2, my=(y1+y2)/2;
        let tx,ty,anchor='middle';
        if(vertical){tx=x1+(side==='right'?12:-12);ty=my;anchor=side==='right'?'start':'end';}
        else{tx=mx;ty=y1+(side==='top'?-8:12);}
        const arrSz=3;
        let arrows='';
        if(vertical){
          arrows=`<polygon points="${x1-arrSz},${y1+arrSz} ${x1+arrSz},${y1+arrSz} ${x1},${y1}" fill="${col.dim}"/>
                   <polygon points="${x2-arrSz},${y2-arrSz} ${x2+arrSz},${y2-arrSz} ${x2},${y2}" fill="${col.dim}"/>`;
        } else {
          arrows=`<polygon points="${x1+arrSz},${y1-arrSz} ${x1+arrSz},${y1+arrSz} ${x1},${y1}" fill="${col.dim}"/>
                   <polygon points="${x2-arrSz},${y2-arrSz} ${x2-arrSz},${y2+arrSz} ${x2},${y2}" fill="${col.dim}"/>`;
        }
        return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${col.dim}" stroke-width="0.75" stroke-dasharray="2"/>
                ${arrows}
                <text x="${tx}" y="${ty}" text-anchor="${anchor}" fill="${col.dim}" font-size="9" font-weight="600">${label}</text>`;
      }

      // Helper: framing studs (vertical lines for structure)
      function studs(x1,x2,yTop,yBot,count){
        let s='';const step=(x2-x1)/(count+1);
        for(let i=1;i<=count;i++){const x=x1+step*i;
          s+=`<line x1="${x}" y1="${yTop}" x2="${x}" y2="${yBot}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="3,3"/>`;}
        return s;
      }

      if (r.type === 'mini-ramp') {
        // Mini Ramp: full cross-section
        const rH = 160; // ramp visual height
        const deckW = 30; // deck/platform width
        const transW = 80; // transition curve area
        const flatW = W - 2*pad - 2*deckW - 2*transW;
        const topY = ground - rH;
        const copY = topY;
        const lDeck = pad; const lCop = pad + deckW;
        const lTransEnd = lCop + transW;
        const rTransStart = W - pad - deckW - transW;
        const rCop = W - pad - deckW; const rDeck = W - pad;

        return `<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="${col.grid}" stroke-width="0.3"/>
            </pattern>
          </defs>
          <rect width="${W}" height="${H}" fill="${col.bg}"/>
          <rect x="${pad}" y="${pad}" width="${W-2*pad}" height="${H-2*pad}" fill="url(#grid)" opacity="0.5"/>

          <!-- Ground line -->
          <line x1="${pad-10}" y1="${ground}" x2="${W-pad+10}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>
          <text x="${W-pad+12}" y="${ground+4}" fill="${col.support}" font-size="8">GROUND</text>

          <!-- Left deck/platform -->
          <rect x="${lDeck}" y="${copY}" width="${deckW}" height="${rH}" fill="${col.struct}11" stroke="${col.struct}" stroke-width="1.5"/>
          <line x1="${lDeck}" y1="${copY}" x2="${lCop}" y2="${copY}" stroke="${col.struct}" stroke-width="2.5"/>
          ${studs(lDeck, lCop, copY, ground, 1)}
          <text x="${lDeck+deckW/2}" y="${copY+rH/2}" text-anchor="middle" fill="${col.label}" font-size="7" transform="rotate(-90,${lDeck+deckW/2},${copY+rH/2})">DECK</text>

          <!-- Left transition curve -->
          <path d="M ${lCop} ${copY} Q ${lCop} ${ground-10} ${lTransEnd} ${ground}" fill="none" stroke="${col.struct}" stroke-width="2"/>
          <!-- Transition framing ribs -->
          ${[0.25,0.5,0.75].map(t => {
            const cx = lCop + (lTransEnd-lCop)*t;
            const cy = copY + (ground-copY)*t*t;
            return `<line x1="${cx}" y1="${cy}" x2="${cx}" y2="${ground}" stroke="${col.frame}" stroke-width="0.8" stroke-dasharray="3,2"/>`;
          }).join('')}
          <!-- Masonite surface indicator -->
          <path d="M ${lCop} ${copY+2} Q ${lCop+2} ${ground-8} ${lTransEnd} ${ground}" fill="none" stroke="${col.accent}" stroke-width="0.8" stroke-dasharray="1,2"/>

          <!-- Flat bottom -->
          <line x1="${lTransEnd}" y1="${ground}" x2="${rTransStart}" y2="${ground}" stroke="${col.struct}" stroke-width="2.5"/>
          <!-- Flat bottom cross-bracing -->
          <line x1="${lTransEnd+10}" y1="${ground-3}" x2="${rTransStart-10}" y2="${ground-3}" stroke="${col.accent}" stroke-width="1" stroke-dasharray="4,3"/>
          ${studs(lTransEnd, rTransStart, ground-15, ground, 4)}

          <!-- Right transition curve -->
          <path d="M ${rTransStart} ${ground} Q ${rCop} ${ground-10} ${rCop} ${copY}" fill="none" stroke="${col.struct}" stroke-width="2"/>
          ${[0.25,0.5,0.75].map(t => {
            const cx = rTransStart + (rCop-rTransStart)*t;
            const cy = ground - (ground-copY)*t*t;
            return `<line x1="${cx}" y1="${cy}" x2="${cx}" y2="${ground}" stroke="${col.frame}" stroke-width="0.8" stroke-dasharray="3,2"/>`;
          }).join('')}
          <path d="M ${rTransStart} ${ground} Q ${rCop-2} ${ground-8} ${rCop} ${copY+2}" fill="none" stroke="${col.accent}" stroke-width="0.8" stroke-dasharray="1,2"/>

          <!-- Right deck/platform -->
          <rect x="${rCop}" y="${copY}" width="${deckW}" height="${rH}" fill="${col.struct}11" stroke="${col.struct}" stroke-width="1.5"/>
          <line x1="${rCop}" y1="${copY}" x2="${rDeck}" y2="${copY}" stroke="${col.struct}" stroke-width="2.5"/>
          ${studs(rCop, rDeck, copY, ground, 1)}
          <text x="${rCop+deckW/2}" y="${copY+rH/2}" text-anchor="middle" fill="${col.label}" font-size="7" transform="rotate(90,${rCop+deckW/2},${copY+rH/2})">DECK</text>

          <!-- Coping pipes -->
          <circle cx="${lCop}" cy="${copY}" r="5" fill="${col.coping}" opacity="0.9"/>
          <circle cx="${lCop}" cy="${copY}" r="2.5" fill="${col.bg}"/>
          <circle cx="${rCop}" cy="${copY}" r="5" fill="${col.coping}" opacity="0.9"/>
          <circle cx="${rCop}" cy="${copY}" r="2.5" fill="${col.bg}"/>

          <!-- Coping labels -->
          <line x1="${lCop}" y1="${copY-6}" x2="${lCop-15}" y2="${copY-22}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${lCop-17}" y="${copY-24}" text-anchor="end" fill="${col.coping}" font-size="8" font-weight="600">2" Steel Coping</text>
          <line x1="${rCop}" y1="${copY-6}" x2="${rCop+15}" y2="${copY-22}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${rCop+17}" y="${copY-24}" fill="${col.coping}" font-size="8" font-weight="600">2" Steel Coping</text>

          <!-- Surface label -->
          <line x1="${lCop+transW*0.4}" y1="${copY + (ground-copY)*0.2}" x2="${lCop+transW*0.4+30}" y2="${copY + (ground-copY)*0.2 - 18}" stroke="${col.accent}" stroke-width="0.5"/>
          <text x="${lCop+transW*0.4+32}" y="${copY + (ground-copY)*0.2 - 20}" fill="${col.accent}" font-size="7">Masonite/Skatelite</text>

          <!-- Flat Bottom label -->
          <text x="${W/2}" y="${ground-18}" text-anchor="middle" fill="${col.label}" font-size="9" font-weight="600">FLAT BOTTOM</text>

          <!-- Transition label -->
          <text x="${lCop + transW/2}" y="${copY + rH*0.55}" text-anchor="middle" fill="${col.label}" font-size="7" transform="rotate(-55,${lCop + transW/2},${copY + rH*0.55})">TRANSITION</text>
          <text x="${rCop - transW/2}" y="${copY + rH*0.55}" text-anchor="middle" fill="${col.label}" font-size="7" transform="rotate(55,${rCop - transW/2},${copY + rH*0.55})">TRANSITION</text>

          <!-- Dimension: Height (left side) -->
          ${dimLine(lDeck-14, copY, lDeck-14, ground, dimLabel(r.height), 'left')}
          <!-- Dimension: Flat Bottom (bottom) -->
          ${dimLine(lTransEnd, ground+16, rTransStart, ground+16, r.flatBottom ? dimLabel(r.flatBottom) : '', 'top')}
          <!-- Dimension: Total Length (bottom) -->
          ${dimLine(pad, ground+30, W-pad, ground+30, dimLabel(r.length) + ' total', 'top')}
          <!-- Dimension: Transition Radius -->
          ${r.transitionRadius ? `<text x="${lCop+transW+5}" y="${copY+12}" fill="${col.dim}" font-size="7">R=${dimLabel(r.transitionRadius)}</text>` : ''}
          <!-- Dimension: Width label -->
          <text x="${W/2}" y="${pad-8}" text-anchor="middle" fill="${col.dim}" font-size="9" font-weight="600">Width: ${dimLabel(r.width)}</text>

          <!-- Scale reference -->
          <line x1="${W-pad-60}" y1="${pad+5}" x2="${W-pad}" y2="${pad+5}" stroke="${col.dim}" stroke-width="1"/>
          <text x="${W-pad-30}" y="${pad+16}" text-anchor="middle" fill="${col.dim}" font-size="7">Scale Ref</text>

          <!-- Title -->
          <text x="${pad}" y="${pad-8}" fill="${col.label}" font-size="10" font-weight="700">CROSS-SECTION ‚Äî ${r.name.toUpperCase()}</text>
        </svg>`;
      } else if (r.type === 'quarter-pipe') {
        // Quarter Pipe: full cross-section
        const qH = 165;
        const topQ = ground - qH;
        const backX = pad + 40; // back wall
        const copX = backX + 20; // coping position
        const transEnd = W - pad - 80; // where transition meets ground

        return `<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="gridq" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="${col.grid}" stroke-width="0.3"/>
            </pattern>
          </defs>
          <rect width="${W}" height="${H}" fill="${col.bg}"/>
          <rect x="${pad}" y="${pad}" width="${W-2*pad}" height="${H-2*pad}" fill="url(#gridq)" opacity="0.5"/>

          <!-- Ground -->
          <line x1="${pad-10}" y1="${ground}" x2="${W-pad+10}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>
          <text x="${W-pad+12}" y="${ground+4}" fill="${col.support}" font-size="8">GROUND</text>

          <!-- Back wall -->
          <rect x="${pad}" y="${topQ}" width="${backX-pad}" height="${qH}" fill="#22c55e11" stroke="#22c55e" stroke-width="1.5"/>
          ${studs(pad, backX, topQ, ground, 2)}
          <text x="${(pad+backX)/2}" y="${topQ+qH/2}" text-anchor="middle" fill="${col.label}" font-size="7" transform="rotate(-90,${(pad+backX)/2},${topQ+qH/2})">BACK WALL</text>

          <!-- Deck/platform -->
          <line x1="${pad}" y1="${topQ}" x2="${copX}" y2="${topQ}" stroke="#22c55e" stroke-width="2.5"/>
          <text x="${(pad+copX)/2}" y="${topQ-5}" text-anchor="middle" fill="${col.label}" font-size="7">DECK</text>

          <!-- Coping -->
          <circle cx="${copX}" cy="${topQ}" r="5" fill="${col.coping}" opacity="0.9"/>
          <circle cx="${copX}" cy="${topQ}" r="2.5" fill="${col.bg}"/>
          <line x1="${copX+6}" y1="${topQ}" x2="${copX+35}" y2="${topQ-18}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${copX+37}" y="${topQ-20}" fill="${col.coping}" font-size="8" font-weight="600">2" Steel Coping</text>

          <!-- Transition curve -->
          <path d="M ${copX} ${topQ} Q ${copX} ${ground-10} ${transEnd} ${ground}" fill="none" stroke="#22c55e" stroke-width="2"/>
          <!-- Transition framing ribs -->
          ${[0.2,0.4,0.6,0.8].map(t => {
            const cx = copX + (transEnd-copX)*t;
            const cy = topQ + (ground-topQ)*t*t;
            return `<line x1="${cx}" y1="${cy}" x2="${cx}" y2="${ground}" stroke="${col.frame}" stroke-width="0.8" stroke-dasharray="3,2"/>`;
          }).join('')}
          <!-- Surface layer -->
          <path d="M ${copX} ${topQ+2} Q ${copX+2} ${ground-8} ${transEnd} ${ground}" fill="none" stroke="${col.accent}" stroke-width="0.8" stroke-dasharray="1,2"/>

          <!-- Approach/flat -->
          <line x1="${transEnd}" y1="${ground}" x2="${W-pad}" y2="${ground}" stroke="#22c55e" stroke-width="2"/>
          <text x="${(transEnd+W-pad)/2}" y="${ground-8}" text-anchor="middle" fill="${col.label}" font-size="8">APPROACH</text>

          <!-- Transition label -->
          <text x="${copX + (transEnd-copX)*0.4}" y="${topQ + qH*0.45}" text-anchor="middle" fill="${col.label}" font-size="8" transform="rotate(-50,${copX + (transEnd-copX)*0.4},${topQ + qH*0.45})">TRANSITION</text>

          <!-- Surface label -->
          <line x1="${copX+(transEnd-copX)*0.3}" y1="${topQ+(ground-topQ)*0.12}" x2="${copX+(transEnd-copX)*0.3+40}" y2="${topQ+(ground-topQ)*0.12-15}" stroke="${col.accent}" stroke-width="0.5"/>
          <text x="${copX+(transEnd-copX)*0.3+42}" y="${topQ+(ground-topQ)*0.12-17}" fill="${col.accent}" font-size="7">3/4" Ply + Masonite</text>

          <!-- Dimension: Height -->
          ${dimLine(pad-14, topQ, pad-14, ground, dimLabel(r.height), 'left')}
          <!-- Dimension: Length -->
          ${dimLine(pad, ground+20, W-pad, ground+20, dimLabel(r.length), 'top')}
          <!-- Dimension: Radius -->
          ${r.transitionRadius ? `<text x="${copX+(transEnd-copX)*0.65}" y="${topQ+qH*0.7}" fill="${col.dim}" font-size="8">R=${dimLabel(r.transitionRadius)}</text>` : ''}
          <!-- Dimension: Width -->
          <text x="${W/2}" y="${pad-8}" text-anchor="middle" fill="${col.dim}" font-size="9" font-weight="600">Width: ${dimLabel(r.width)}</text>

          <!-- Title -->
          <text x="${pad}" y="${pad-8}" fill="${col.label}" font-size="10" font-weight="700">CROSS-SECTION ‚Äî ${r.name.toUpperCase()}</text>
        </svg>`;
      } else if (r.type === 'kicker') {
        // Kicker: full cross-section with wedge shape
        const kH = 120;
        const kTopY = ground - kH;
        const kLeft = pad + 60;
        const kRight = W - pad - 60;
        const kPeakX = kLeft + 60; // peak of the lip

        return `<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="gridk" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="${col.grid}" stroke-width="0.3"/>
            </pattern>
          </defs>
          <rect width="${W}" height="${H}" fill="${col.bg}"/>
          <rect x="${pad}" y="${pad}" width="${W-2*pad}" height="${H-2*pad}" fill="url(#gridk)" opacity="0.5"/>

          <!-- Ground -->
          <line x1="${pad-10}" y1="${ground}" x2="${W-pad+10}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>

          <!-- Kicker body - wedge/ramp shape -->
          <path d="M ${kLeft} ${ground} L ${kLeft} ${kTopY+30} Q ${kLeft} ${kTopY} ${kPeakX} ${kTopY} L ${kRight} ${ground} Z" fill="${col.struct}08" stroke="${col.struct}" stroke-width="2"/>

          <!-- Curved lip surface -->
          <path d="M ${kLeft} ${ground} L ${kLeft} ${kTopY+30} Q ${kLeft} ${kTopY} ${kPeakX} ${kTopY}" fill="none" stroke="${col.accent}" stroke-width="2.5"/>

          <!-- Bottom/approach surface -->
          <line x1="${kPeakX}" y1="${kTopY}" x2="${kRight}" y2="${ground}" stroke="${col.struct}" stroke-width="2"/>

          <!-- Internal framing -->
          ${[0.25, 0.5, 0.75].map(t => {
            const fx = kLeft + (kRight-kLeft)*t;
            const fTopY = kTopY + (ground-kTopY)*(t > 0.3 ? (t-0.15)*1.3 : 0.1);
            return `<line x1="${fx}" y1="${Math.min(fTopY, ground)}" x2="${fx}" y2="${ground}" stroke="${col.frame}" stroke-width="0.8" stroke-dasharray="3,2"/>`;
          }).join('')}

          <!-- Cross brace -->
          <line x1="${kLeft+20}" y1="${ground-20}" x2="${kRight-20}" y2="${ground-20}" stroke="${col.frame}" stroke-width="0.7" stroke-dasharray="4,3"/>

          <!-- Lip/launch point -->
          <circle cx="${kPeakX}" cy="${kTopY}" r="4" fill="${col.coping}" opacity="0.9"/>
          <line x1="${kPeakX}" y1="${kTopY-5}" x2="${kPeakX-20}" y2="${kTopY-25}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${kPeakX-22}" y="${kTopY-27}" text-anchor="end" fill="${col.coping}" font-size="8" font-weight="600">Launch Lip</text>

          <!-- Surface label -->
          <text x="${(kPeakX+kRight)/2-10}" y="${kTopY + (ground-kTopY)*0.4}" text-anchor="middle" fill="${col.label}" font-size="8" transform="rotate(30,${(kPeakX+kRight)/2-10},${kTopY + (ground-kTopY)*0.4})">RAMP SURFACE</text>

          <!-- Plywood label -->
          <line x1="${kLeft+15}" y1="${kTopY+40}" x2="${kLeft+50}" y2="${kTopY+20}" stroke="${col.accent}" stroke-width="0.5"/>
          <text x="${kLeft+52}" y="${kTopY+18}" fill="${col.accent}" font-size="7">3/4" Plywood</text>

          <!-- Framing label -->
          <text x="${W/2}" y="${ground-8}" text-anchor="middle" fill="${col.label}" font-size="7">2√ó4 FRAMING</text>

          <!-- Approach arrows -->
          <line x1="${kLeft-40}" y1="${ground-5}" x2="${kLeft-10}" y2="${ground-5}" stroke="${col.dim}" stroke-width="1" marker-end="url(#arr)"/>
          <text x="${kLeft-50}" y="${ground-2}" text-anchor="end" fill="${col.dim}" font-size="8">APPROACH ‚Üí</text>

          <!-- Dimension: Height -->
          ${dimLine(kLeft-18, kTopY, kLeft-18, ground, dimLabel(r.height), 'left')}
          <!-- Dimension: Length -->
          ${dimLine(kLeft, ground+20, kRight, ground+20, dimLabel(r.length), 'top')}
          <!-- Dimension: Width -->
          <text x="${W/2}" y="${pad-8}" text-anchor="middle" fill="${col.dim}" font-size="9" font-weight="600">Width: ${dimLabel(r.width)}</text>

          <!-- Angle indicator -->
          <path d="M ${kRight-30} ${ground} A 30 30 0 0 0 ${kRight-30+30*Math.cos(Math.atan2(ground-(kTopY),(kRight-kPeakX)))} ${ground-30*Math.sin(Math.atan2(ground-(kTopY),(kRight-kPeakX)))}" fill="none" stroke="${col.dim}" stroke-width="0.7"/>
          <text x="${kRight-15}" y="${ground-15}" fill="${col.dim}" font-size="7">~${Math.round(Math.atan2(r.height, r.length*0.6)*180/Math.PI)}¬∞</text>

          <!-- Title -->
          <text x="${pad}" y="${pad-8}" fill="${col.label}" font-size="10" font-weight="700">CROSS-SECTION ‚Äî ${r.name.toUpperCase()}</text>
        </svg>`;
      } else if (r.type === 'box') {
        // Grind Box: full cross-section with framing
        const bH = 80;
        const bTopY = ground - bH;
        const bLeft = pad + 80;
        const bRight = W - pad - 80;
        const bW = bRight - bLeft;

        return `<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="gridb" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="${col.grid}" stroke-width="0.3"/>
            </pattern>
          </defs>
          <rect width="${W}" height="${H}" fill="${col.bg}"/>
          <rect x="${pad}" y="${pad}" width="${W-2*pad}" height="${H-2*pad}" fill="url(#gridb)" opacity="0.5"/>

          <!-- Ground -->
          <line x1="${pad-10}" y1="${ground}" x2="${W-pad+10}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>

          <!-- Box body -->
          <rect x="${bLeft}" y="${bTopY}" width="${bW}" height="${bH}" fill="#ef444408" stroke="#ef4444" stroke-width="2" rx="2"/>

          <!-- Top surface (plywood) -->
          <rect x="${bLeft}" y="${bTopY}" width="${bW}" height="6" fill="#ef444422" stroke="#ef4444" stroke-width="1"/>
          <text x="${W/2}" y="${bTopY+4}" text-anchor="middle" fill="${col.label}" font-size="6" dominant-baseline="middle">3/4" PLYWOOD TOP</text>

          <!-- Steel coping edges (both sides) -->
          <line x1="${bLeft}" y1="${bTopY}" x2="${bLeft}" y2="${bTopY-3}" stroke="${col.coping}" stroke-width="4" stroke-linecap="round"/>
          <line x1="${bRight}" y1="${bTopY}" x2="${bRight}" y2="${bTopY-3}" stroke="${col.coping}" stroke-width="4" stroke-linecap="round"/>
          <line x1="${bLeft}" y1="${bTopY}" x2="${bRight}" y2="${bTopY}" stroke="${col.coping}" stroke-width="3"/>

          <!-- Steel edge labels -->
          <line x1="${bLeft}" y1="${bTopY-4}" x2="${bLeft-25}" y2="${bTopY-30}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${bLeft-27}" y="${bTopY-32}" text-anchor="end" fill="${col.coping}" font-size="8" font-weight="600">Steel L-Angle</text>
          <line x1="${bRight}" y1="${bTopY-4}" x2="${bRight+25}" y2="${bTopY-30}" stroke="${col.coping}" stroke-width="0.7"/>
          <text x="${bRight+27}" y="${bTopY-32}" fill="${col.coping}" font-size="8" font-weight="600">Steel L-Angle</text>

          <!-- Internal framing - 2x4 studs -->
          ${[0.2, 0.4, 0.6, 0.8].map(t => {
            const x = bLeft + bW*t;
            return `<line x1="${x}" y1="${bTopY+6}" x2="${x}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>`;
          }).join('')}

          <!-- Cross braces -->
          <line x1="${bLeft+15}" y1="${bTopY + bH*0.4}" x2="${bRight-15}" y2="${bTopY + bH*0.4}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="4,3"/>
          <line x1="${bLeft+15}" y1="${bTopY + bH*0.75}" x2="${bRight-15}" y2="${bTopY + bH*0.75}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="4,3"/>

          <!-- Side walls -->
          <line x1="${bLeft}" y1="${bTopY}" x2="${bLeft}" y2="${ground}" stroke="#ef4444" stroke-width="2"/>
          <line x1="${bRight}" y1="${bTopY}" x2="${bRight}" y2="${ground}" stroke="#ef4444" stroke-width="2"/>

          <!-- Framing label -->
          <text x="${W/2}" y="${bTopY + bH*0.55}" text-anchor="middle" fill="${col.label}" font-size="8">2√ó4 FRAMING</text>

          <!-- Bottom plate -->
          <line x1="${bLeft}" y1="${ground}" x2="${bRight}" y2="${ground}" stroke="#ef4444" stroke-width="2.5"/>
          <text x="${W/2}" y="${ground+12}" text-anchor="middle" fill="${col.label}" font-size="7">BOTTOM PLATE</text>

          <!-- Dimension: Height -->
          ${dimLine(bLeft-22, bTopY, bLeft-22, ground, dimLabel(r.height), 'left')}
          <!-- Dimension: Length -->
          ${dimLine(bLeft, ground+26, bRight, ground+26, dimLabel(r.length), 'top')}
          <!-- Dimension: Width -->
          <text x="${W/2}" y="${pad-8}" text-anchor="middle" fill="${col.dim}" font-size="9" font-weight="600">Width: ${dimLabel(r.width)}</text>

          <!-- Title -->
          <text x="${pad}" y="${pad-8}" fill="${col.label}" font-size="10" font-weight="700">CROSS-SECTION ‚Äî ${r.name.toUpperCase()}</text>
        </svg>`;
      } else {
        // Rail: full cross-section with legs, crossbars, footplates
        const rlH = 90;
        const rlTopY = ground - rlH;
        const rlLeft = pad + 80;
        const rlRight = W - pad - 80;
        const rlLen = rlRight - rlLeft;

        return `<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern id="gridr" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="${col.grid}" stroke-width="0.3"/>
            </pattern>
          </defs>
          <rect width="${W}" height="${H}" fill="${col.bg}"/>
          <rect x="${pad}" y="${pad}" width="${W-2*pad}" height="${H-2*pad}" fill="url(#gridr)" opacity="0.5"/>

          <!-- Ground -->
          <line x1="${pad-10}" y1="${ground}" x2="${W-pad+10}" y2="${ground}" stroke="${col.frame}" stroke-width="1.5"/>

          <!-- Rail pipe -->
          <line x1="${rlLeft-10}" y1="${rlTopY}" x2="${rlRight+10}" y2="${rlTopY}" stroke="#a855f7" stroke-width="5" stroke-linecap="round"/>
          <!-- Rail pipe highlight (3D effect) -->
          <line x1="${rlLeft-8}" y1="${rlTopY-1.5}" x2="${rlRight+8}" y2="${rlTopY-1.5}" stroke="#c084fc" stroke-width="1" stroke-linecap="round" opacity="0.5"/>

          <!-- Rail label -->
          <line x1="${W/2}" y1="${rlTopY-4}" x2="${W/2}" y2="${rlTopY-25}" stroke="#a855f7" stroke-width="0.7"/>
          <text x="${W/2}" y="${rlTopY-28}" text-anchor="middle" fill="#a855f7" font-size="9" font-weight="600">Round Steel Rail</text>

          <!-- Legs (4 legs with gussets) -->
          ${[0, 0.33, 0.66, 1].map(t => {
            const lx = rlLeft + rlLen*t;
            return `
              <line x1="${lx}" y1="${rlTopY+2}" x2="${lx}" y2="${ground}" stroke="#a855f7" stroke-width="2.5"/>
              <!-- Gusset/brace -->
              <path d="M ${lx} ${rlTopY+8} L ${lx+12} ${rlTopY+20} L ${lx} ${rlTopY+20} Z" fill="#a855f722" stroke="#a855f7" stroke-width="0.7"/>
              <path d="M ${lx} ${rlTopY+8} L ${lx-12} ${rlTopY+20} L ${lx} ${rlTopY+20} Z" fill="#a855f722" stroke="#a855f7" stroke-width="0.7"/>
              <!-- Foot plate -->
              <rect x="${lx-15}" y="${ground-4}" width="30" height="4" fill="#a855f744" stroke="#a855f7" stroke-width="1" rx="1"/>
            `;
          }).join('')}

          <!-- Cross braces between legs -->
          <line x1="${rlLeft}" y1="${rlTopY + rlH*0.5}" x2="${rlLeft+rlLen*0.33}" y2="${rlTopY + rlH*0.5}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="4,3"/>
          <line x1="${rlLeft+rlLen*0.33}" y1="${rlTopY + rlH*0.5}" x2="${rlLeft+rlLen*0.66}" y2="${rlTopY + rlH*0.5}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="4,3"/>
          <line x1="${rlLeft+rlLen*0.66}" y1="${rlTopY + rlH*0.5}" x2="${rlRight}" y2="${rlTopY + rlH*0.5}" stroke="${col.frame}" stroke-width="1" stroke-dasharray="4,3"/>

          <!-- Component labels -->
          <text x="${rlLeft + rlLen*0.16}" y="${rlTopY + rlH*0.35}" text-anchor="middle" fill="${col.label}" font-size="7">LEG</text>
          <text x="${rlLeft + rlLen*0.5}" y="${rlTopY + rlH*0.55 + 10}" text-anchor="middle" fill="${col.label}" font-size="7">CROSS BRACE</text>

          <!-- Foot plate label -->
          <line x1="${rlRight+12}" y1="${ground-2}" x2="${rlRight+35}" y2="${ground-20}" stroke="#a855f7" stroke-width="0.5"/>
          <text x="${rlRight+37}" y="${ground-22}" fill="#a855f7" font-size="7">Foot Plate</text>

          <!-- Gusset label -->
          <line x1="${rlLeft+14}" y1="${rlTopY+14}" x2="${rlLeft+40}" y2="${rlTopY+8}" stroke="${col.label}" stroke-width="0.5"/>
          <text x="${rlLeft+42}" y="${rlTopY+11}" fill="${col.label}" font-size="7">Gusset</text>

          <!-- Dimension: Height -->
          ${dimLine(rlLeft-30, rlTopY, rlLeft-30, ground, dimLabel(r.height), 'left')}
          <!-- Dimension: Length -->
          ${dimLine(rlLeft, ground+22, rlRight, ground+22, dimLabel(r.length), 'top')}
          <!-- Dimension: Width -->
          <text x="${W/2}" y="${pad-8}" text-anchor="middle" fill="${col.dim}" font-size="9" font-weight="600">Width: ${dimLabel(r.width)}</text>

          <!-- Title -->
          <text x="${pad}" y="${pad-8}" fill="${col.label}" font-size="10" font-weight="700">CROSS-SECTION ‚Äî ${r.name.toUpperCase()}</text>
        </svg>`;
      }
    }

    document.getElementById('modalClose').addEventListener('click', () => {
      document.getElementById('modal').classList.remove('active');
      document.body.style.overflow = '';
      currentModalRampId = null;
    });
    document.getElementById('modal').addEventListener('click', e => {
      if (e.target === document.getElementById('modal')) {
        document.getElementById('modal').classList.remove('active');
        document.body.style.overflow = '';
        currentModalRampId = null;
      }
    });

    // Custom Dimension Calculator
    function initCalculator() {
      const sel = document.getElementById('calcType');
      const types = [...new Set(ramps.map(r => r.type))];
      const labels = { 'mini-ramp': 'Mini Ramp', 'quarter-pipe': 'Quarter Pipe', 'kicker': 'Kicker', 'box': 'Grind Box', 'rail': 'Rail' };
      sel.innerHTML = types.map(t => `<option value="${t}">${labels[t] || t}</option>`).join('');

      // Pre-fill with reference dims when type changes
      sel.addEventListener('change', prefillDims);
      prefillDims();

      document.getElementById('calcBtn').addEventListener('click', calculate);
    }

    function prefillDims() {
      const type = document.getElementById('calcType').value;
      const ref = ramps.find(r => r.type === type);
      if (ref) {
        document.getElementById('calcHeight').placeholder = `e.g. ${dimVal(ref.height)}`;
        document.getElementById('calcWidth').placeholder = `e.g. ${dimVal(ref.width)}`;
        document.getElementById('calcLength').placeholder = `e.g. ${dimVal(ref.length)}`;
      }
    }

    function calculate() {
      const type = document.getElementById('calcType').value;
      let h = parseFloat(document.getElementById('calcHeight').value);
      let w = parseFloat(document.getElementById('calcWidth').value);
      let l = parseFloat(document.getElementById('calcLength').value);

      if (!h || !w || !l || h <= 0 || w <= 0 || l <= 0) {
        document.getElementById('calcResult').innerHTML = '<p style="color:var(--red)">Please enter valid dimensions for all fields.</p>';
        return;
      }

      // Display values in current unit
      const dispH = h, dispW = w, dispL = l;
      // Convert to inches for internal math
      if (currentUnit === 'metric') { h /= IN_TO_CM; w /= IN_TO_CM; l /= IN_TO_CM; }

      // Find the closest reference ramp of this type
      const refs = ramps.filter(r => r.type === type);
      if (!refs.length) return;

      // Pick the reference ramp closest in volume
      const customVol = h * w * l;
      let best = refs[0];
      let bestDiff = Math.abs((best.height * best.width * best.length) - customVol);
      for (const r of refs) {
        const d = Math.abs((r.height * r.width * r.length) - customVol);
        if (d < bestDiff) { best = r; bestDiff = d; }
      }

      const refVol = best.height * best.width * best.length;
      const scale = customVol / refVol;

      // Scale materials
      const scaled = best.materials.filter(m => !m.optional).map(m => {
        let qty = m.qty * scale;
        // Round up ‚Äî you can't buy half a sheet of plywood
        qty = Math.ceil(qty);
        if (qty < 1) qty = 1;
        return { item: m.item, qty, use: m.use };
      });

      // Optional materials
      const optional = best.materials.filter(m => m.optional);

      // Estimate cost by scaling
      const costScale = scale;
      const costMin = Math.round(best.estimatedCost.min * costScale);
      const costMax = Math.round(best.estimatedCost.max * costScale);

      // Render result
      const rows = scaled.map(m => `<tr><td>${m.item}</td><td class="qty">${m.qty}</td><td style="color:var(--text-dim)">${m.use}</td></tr>`).join('');
      const optRows = optional.map(m => `<tr style="opacity:0.6"><td>${m.item} ‚≠ê</td><td class="qty">‚Äì</td><td style="color:var(--text-dim)">${m.use}</td></tr>`).join('');

      document.getElementById('calcResult').innerHTML = `
        <div class="calc-summary">
          <div class="box"><div class="val">${dispH}${unitSuffix()}</div><div class="label">Height</div></div>
          <div class="box"><div class="val">${dispW}${unitSuffix()}</div><div class="label">Width</div></div>
          <div class="box"><div class="val">${dispL}${unitSuffix()}</div><div class="label">Length</div></div>
          <div class="box"><div class="val">${scale.toFixed(2)}√ó</div><div class="label">Scale Factor</div></div>
        </div>
        <h3 class="section-title">üì¶ Scaled Materials List</h3>
        <p style="color:var(--text-dim);font-size:0.85rem;margin-bottom:1rem">Based on <strong>${best.name}</strong> scaled ${scale < 1 ? 'down' : 'up'} by ${scale.toFixed(2)}√ó ‚Äî all quantities rounded up.</p>
        <table><thead><tr><th>Material</th><th style="text-align:center">Qty</th><th>Use</th></tr></thead><tbody>${rows}${optRows}</tbody></table>
        <div class="calc-cost">üí∞ Estimated Cost: $${costMin} ‚Äì $${costMax}</div>
      `;
    }

    // Unit toggle
    document.getElementById('unitToggle').addEventListener('click', e => {
      const btn = e.target.closest('button[data-unit]');
      if (!btn || btn.classList.contains('active')) return;
      currentUnit = btn.dataset.unit;
      document.querySelectorAll('#unitToggle button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // Update calc labels
      document.querySelectorAll('.calc-unit-label').forEach(el => el.textContent = unitWord());
      // Re-render grid + refresh placeholders
      renderGrid();
      prefillDims();
      // Re-render modal if open
      const modalEl = document.getElementById('modal');
      if (modalEl.classList.contains('active') && currentModalRampId) {
        openModal(currentModalRampId);
      }
    });

    init();
  </script>
</body>
</html>
